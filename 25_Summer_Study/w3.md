# 6. ë¹„ì§€ë„ í•™ìŠµ

## ğŸ“Œ êµ°ì§‘ ì•Œê³ ë¦¬ì¦˜

* ë¹„ì§€ë„í•™ìŠµ : íƒ€ê²Ÿì´ ì—†ì„ë•Œ ë¶„ë¥˜í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ì•Œê³ ë¦¬ì¦˜

>### ê³¼ì¼ ë°ì´í„°
* (300,100,100) í¬ê¸° = 300ê°œì˜ ìƒ˜í”Œ, 100*100í¬ê¸°ì˜ ì´ë¯¸ì§€, 100ì”© ì‚¬ê³¼, íŒŒì¸ì• í”Œ, ë°”ë‚˜ë‚˜
* ë§·í”Œë¡¯ë¦½ì˜ imshow() í•¨ìˆ˜ë¥¼ í†µí•´ ë„˜íŒŒì´ ë°°ì—´ë¡œ ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ê·¸ë¦´ ìˆ˜ ìˆìŒ
    * í‘ë°±ì´ë¯€ë¡œ(ì»¬ëŸ¬ëŠ” 4ì°¨ì› í…ì„œ) cmap ë§¤ê°œë³€ìˆ˜ë¥¼ gray

```python
plt.imshow(fruits[0], cmap='gray') # ë°ì€ ë¶€ë¶„ì€ 255(ìˆ«ì)ì— ê°€ê¹Œì›€ -> ì‹¤ì œì™€ëŠ” ê´´ë¦¬ê°€ ìˆìŒ -> gray_r 
plt.show()
```
![](../25_Summer_Study/images/w3/fruit.png)

```python
plt.imshow(fruits[0], cmap='gray_r')
plt.show()
```
![](../25_Summer_Study/images/w3/fruit2.png)

>### í”½ì…€ê°’ ë¶„ì„í•˜ê¸°
* ë„˜íŒŒì´ ë°°ì—´ì„ ë‚˜ëˆŒ ë•Œ 100*100 ì´ë¯¸ì§€ë¥¼ 10000ì¸ 1ì°¨ì› ë°°ì—´ë¡œ ë§Œë“¤ê¸° for ê³„ì‚°
1) ê³¼ì¼ì´ ê° 100ê°œì”© ìˆìœ¼ë¯€ë¡œ 100ê°œì”© ìŠ¬ë¼ì´ì‹±
2) ìŠ¬ë¼ì´ì‹±ì„ í†µí•´ 2, 3ì°¨ì›ì„ 10000ìœ¼ë¡œ í•©ì¹¨

```python
apple = fruits[:100].reshape(-1, 100*100)
pineapple = fruits[100:200].reshape(-1, 100*100)
banana = fruits[200:].reshape(-1, 100*100)
```
* ê° ê³¼ì¼ì˜ í”½ì…€ í‰ê· ê°’ ê³„ì‚°í•˜ê¸°
    * axis = 0 : í–‰ì„ ë”°ë¼ ê³„ì‚°(í•˜ë‚˜ì˜ ì—´ì—ëŒ€í•´ ê³„ì‚°)
    * axis =1 : ì—´ ë”°ë¼ ê³„ì‹¼(í•˜ë‚˜ì˜ í–‰ì— ëŒ€í•´ ê³„ì‚°)
    * ìš°ë¦¬ê°€ í•„ìš”í•œê±´ ìƒ˜í”Œì˜ í‰ê· ê°’, ìš°ë¦¬ëŠ” ìƒ˜í”Œì„ ê°€ë¡œë¡œ ë‚˜ì—´(1* 10000)í–ˆìœ¼ë¯€ë¡œ í–‰ê¸°ì¤€ ê³„ì‚°ì´ í•„ìš”

```python
# axis =1 ë¡œ í•˜ë‚˜ì˜ í–‰ì— ëŒ€í•´ í”½ì…€ê°’ í‰ê·  ê³„ì‚°
print(apple.mean(axis=1))
```

```python
# íˆìŠ¤í† ê·¸ë¨
plt.hist(np.mean(apple, axis=1),alpha = 0.8)
plt.hist(np.mean(pineapple, axis=1), alpha = 0.8)
plt.hist(np.mean(banana, axis=1), alpha = 0.8)
```

![](../25_Summer_Study/images/w3/fruit3.png)
âœ… ë°”ë‚˜ë‚˜ëŠ” ë‚®ì€ í•„ì…€ê°’, ì‚¬ê³¼ì™€ íŒŒì¸ì• í”Œì€ í”½ì…€ê°’ë§Œìœ¼ë¡œ êµ¬ë¶„í•˜ê¸° ì‰½ì§€ ì•ŠìŒ
* why?: íŒŒì¸ì• í”Œê³¼ ì‚¬ê³¼ëŠ” ì‚¬ì§„ì´ í¬ê³  ë™ê·¸ë—ê¸° ë•Œë¬¸. ë°”ë‚˜ë‚˜ëŠ” ì‚¬ì§„ì´ ì‘ê³  ê¸¸ì­‰í•œ ì°¨ì´
* í•´ê²° ë°©ë²• : ìƒ˜í”Œì˜ í‰ê· ê°’ì´ ì•„ë‹ˆ
ë¼ í”½ì…€ë³„ í‰ê· ê°’ = ì „ì²´ ìƒ˜í”Œì— ëŒ€í•´ ê° í”½ì…€(0~9999)ì˜ í‰ê· ê°’ => axis = 0 ìœ¼ë¡œ ì§€ì •í•˜ë©´ ë¨

```python
# ì „ì²´ ìƒ˜í”Œì— ëŒ€í•´ ê° í”½ì…€ë³„ í‰ê· ê°’ ë¹„êµ
fix, axes = plt.subplots(1,3,figsize=(20,5))
axes[0].bar(range(10000), np.mean(apple, axis=0))
axes[1].bar(range(10000), np.mean(pineapple, axis=0))
axes[2].bar(range(10000), np.mean(banana, axis=0))
```
![](../25_Summer_Study/images/w3/fruits4.png)

 âœ… ê³¼ì¼ë§ˆë‹¤ ë†’ì€ êµ¬ê°„ì´ ë‹¤ë¦„, ë°”ë‚˜ë‚˜ëŠ” í™•ì‹¤íˆ ì¤‘ì•™ì˜ í”½ì…€ê°’ì´ ë†’ìŒ

 * í”½ì…€ì˜ í‰ê· ê°’ì“ 100*100 í¬ê¸°ë¡œ ë°”ê¾¸ì–´ ì´ë¯¸ì§€ë¡œ ì¶œë ¥
 ```python
 apple_mean = np.mean(apple, axis=0).reshape(100,100)
pineapple_mean = np.mean(pineapple, axis=0).reshape(100,100)
banana_mean = np.mean(banana, axis=0).reshape(100,100)
fig, axes = plt.subplots(1,3,figsize=(20,5))
axes[0].imshow(apple_mean, cmap='gray_r')
axes[1].imshow(pineapple_mean, cmap='gray_r')
axes[2].imshow(banana_mean, cmap='gray_r')
plt.show()
```
![](../25_Summer_Study/images/w3/fruits5.png)

>### í‰ê· ê°’ê³¼ ê°€ê¹Œìš´ ì‚¬ì§„ ê³ ë¥´ê¸°
* ì‚¬ê³¼ ì‚¬ì§„ì˜ í‰ê· ê°’ì¸ apple_mean(100*100 array)ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ì‚¬ì§„ ê³ ë¥´ê¸° by abs() í•¨ìˆ˜
```python
abs_diff = np.abs(fruits - apple_mean)
abs_mean = np.mean(abs_diff, axis=(1,2))
print(abs_mean.shape) # 300ê°œ ì‚¬ì§„ì— ëŒ€í•´ ì‚¬ê³¼ í‰ê· ê³¼ ì°¨ì´ì´ë¯€ë¡œ (300,)ì¸ 1ì°¨ì› ë°°ì—´
```

* ì´ ê°’ì´ ê°€ì¥ ì‘ì€ ìˆœì„œëŒ€ë¡œ 100ê°œ ê³ ë¥´ê¸°  = ê°€ì¥ ë¹„ìŠ·í•œ ì‚¬ì§„ 100ê°œ ê³ ë¥´ê¸°
    * np.argsort() ì‘ì€ê²ƒì—ì„œ í° ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•œ ì¸ë±ìŠ¤ ë°˜í™˜
```python
apple_index =  np.argsort(abs_mean)[:100]
fig, axes = plt.subplots(10,10,figsize=(10,10)) # subplot 100ê°œ ìƒì„±
for i in range(10): # í–‰
  for j in range(10): # ì—´
    axes[i,j].imshow(fruits[apple_index[i*10+j]],cmap = 'gray_r')
    axes[i,j].axis('off') # axis('off') ê¹”ë”í•˜ê²Œ ê·¸ë¦¬ê¸° ìœ„í•´ ì¢Œí‘œì¶• ê·¸ë¦¬ì§€ ì•ŠìŒ
plt.show()
```
![](../25_Summer_Study/images/w3/fruits6.png)

>### ì‹¤ì œ ë¹„ì§€ë„ í•™ìŠµ
: ì‹¤ì œë¡œëŠ” íƒ€ê¹ƒê°’ì„ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ë°ì´í„°ì— ìˆëŠ” íŒ¨í„´ì„ ì°¾ì•„ì•¼í•¨
* êµ°ì§‘ : ë¹„ìŠ·í•œ ìƒ˜í”Œë¼ë¦¬ ê·¸ë£¹ìœ¼ë¡œ ëª¨ìœ¼ëŠ” ì‘ì—…
* ë‹¤ìŒì ˆì—ì„œëŠ” íƒ€ê¹ƒì´ ì—†ëŠ” ì‚¬ì§„ ì‚¬ìš©í• ê²ƒ

## ğŸ“Œ k-means clustering

>### intro
* ì•ì˜ ì˜ˆì‹œì—ì„  ì‚¬ê³¼, íŒŒì¸, ë°”ë‚˜ë‚˜ ì‚¬ì§„ì„ì„ ì´ë¯¸ ì•Œê³  ìˆì—ˆìŒ. í•˜ì§€ë§Œ ì§„ì§œ ë¹„ì§€ë„ í•™ìŠµì—ì„œëŠ” ì–´ë–¤ ê³¼ì¼ì´ ìˆëŠ”ì§€ ëª¨ë¦„ => k-means ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©

* k-means : í‰ê· ê°’ì´ í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ì— ìœ„ì¹˜

>### K-Means ì•Œê³ ë¦¬ì¦˜ ì†Œê°œ
1) ë¬´ì‘ìœ„ë¡œ kê°œ í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ ì •í•¨
2) ê° ìƒ˜í”Œì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ì„ ì°¾ì•„ í•´ë‹¹ í´ëŸ¬ìŠ¤í„°ì— ë°°ì •
3) í´ëŸ¬ìŠ¤í„°ì— ì†í•œ ìƒ˜í”Œì˜ í‰ê· ê°’ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ ë³€ê²½
4) í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ì— ë³€í™”ê°€ ì—†ì„ ë•Œê¹Œì§€ ë°˜ë³µ

>### êµ¬í˜„

```python
fruits_2d = fruits.reshape(-1, 100*100)
from sklearn.cluster import KMeans
km = KMeans(n_clusters=3, random_state=42)
km.fit(fruits_2d)
print(km.labels_)
```
* 3ê°œì˜ í´ëŸ¬ìŠ¤í„°(n_clusters ë©”ì„œë“œ ì‚¬ìš©)
* êµ°ì§‘ì˜ ê²°ê³¼ëŠ” labels_ì†ì„±ì— ì €ì¥ë¨
* ê° ë ˆì´ë¸”ë§ˆë‹¤ ëª‡ê°œê°€ ìˆëŠ”ì§€ í™•ì¸ : ```print(np.unique(km.labels_, return_counts=True))```
* ê° í´ëŸ¬ìŠ¤í„°ê°€ ì–´ë–¤ ê·¸ë¦¼ì„ ë‚˜íƒ€ëƒˆëŠ”ì§€ ì¶œë ¥ 
    : figsizeëŠ” ratioì— ë¹„ë¡€í•˜ì—¬ ì»¤ì§
    ```python
    def draw_fruits(arr, ratio=1):
        n = len(arr) 
        rows = int(np.ceil(n/10)) # í–‰ ê°œìˆ˜
        cols = n if rows<2 else 10
        fig, axs = plt.subplots(rows, cols, figsize=(cols*ratio, rows*ratio), squeeze=False)
        for i in range(rows):
            for j in range(cols):
                if i*10 + j <n:
                    axs[i,j].imshow(arr[i*10+j], cmap='gray_r')
                axs[i,j].axis('off')
        plt.show()
    ```
    * ë ˆì´ë¸” 0(í´ëŸ¬ìŠ¤í„° 1) ì‚¬ì§„ ì¶œë ¥ by ```km.labels_ == 0```
    
    ```python
    draw_fruits(fruits[km.labels_==0])
    ```
![]()
-> ì™„ë²½í•˜ê²Œ êµ¬ë³„í•˜ì§„ ëª»í•˜ì§€ë§Œ ê·¸ë˜ë„ ìŠ¤ìŠ¤ë¡œ ë¹„ìŠ·í•œ ìƒ˜í”Œì„ ì˜ ëª¨ìŒ
>### í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬
* ìµœì¢… í´ëŸ¬ìŠ¤í„°ì˜ ì¤‘ì‹¬ì€ ```cluster_centers_``` ì†ì„±ì— ì €ì¥ë¨
```python
draw_fruits(km.cluster_centers_.reshape(-1, 100, 100), ratio=3)
```
* ê°€ì¥ ê°€ê¹Œìš´ í´ëŸ¬ìŠ¤í„°ë¡œ ì˜ˆì¸¡ by predict()
```python
print(km.predict(fruits_2d[100:101]))
```

>### ìµœì ì˜ k ì°¾ê¸°
âœ… **ì—˜ë³´ìš° method**
: í´ëŸ¬ìŠ¤í„° ì¤‘ì‹¬ê³¼ ìƒ˜í”Œì˜ ê±°ë¦¬ì˜ ì œê³±í•© = ì´ë‹ˆì…”ë¼ê³  ì •ì˜
* ì¼ë°˜ì ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ê°€ ëŠ˜ì–´ë‚˜ë©´ ì´ë‹ˆì…”ê°€ ì¤„ì–´ë“¬
* ì´ë•Œ í´ëŸ¬ìŠ¤í„° ê°œìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ë©´ì„œ ì´ë‹ˆì…”ë¥¼ ê·¸ë˜í”„ë¡œ ê·¸ë¦¬ë©´ ê°ì†Œí•˜ëŠ” ì†ë„ê°€ êº½ì´ëŠ” ì§€ì  ì¡´ì¬ => ì´ ì§€ì ë¶€í„° í´ëŸ¬ã…—ìŠ¤í„°ì— ì˜ ë°€ì§‘ëœ ì •ë„ê°€ ê°œì„ ë˜ì§€ ì•ŠìŒ = 

* ```inertia_``` ì‚¬ìš©í•˜ì—¬ ê³„ì‚°
    * kë¥¼ 2~6ê¹Œì§€ ë³€í™”ì‹œí‚¤ë©´ì„œ kmeans 5ë²ˆ í›ˆë ¨
```python
inertia = []
for k in range(2,7):
  km = KMeans(n_clusters=k, random_state=42)
  km.fit(fruits_2d)
  inertia.append(km.inertia_)
plt.plot(range(2,7), inertia)
plt.xlabel('k')
plt.ylabel('inertia')
plt.show()
```
-> k = 3 ê²°ì •!